(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76fc0b40"],{"0e8c":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("base-card",{staticClass:"container-header"},[a("el-form",{staticClass:"demo-form-inline",staticStyle:{"max-width":"1280px"},attrs:{inline:!0,model:t.formData,size:"mini"}},[a("el-form-item",{attrs:{label:"昵称"}},[a("el-input",{attrs:{placeholder:"请输入昵称"},model:{value:t.formData.nickName,callback:function(e){t.$set(t.formData,"nickName",e)},expression:"formData.nickName"}})],1),a("el-form-item",{attrs:{label:"订单ID"}},[a("el-input",{attrs:{placeholder:"请输入订单ID"},model:{value:t.formData.orderId,callback:function(e){t.$set(t.formData,"orderId",e)},expression:"formData.orderId"}})],1),a("el-form-item",{attrs:{label:"单号"}},[a("el-input",{attrs:{placeholder:"请输入单号"},model:{value:t.formData.number,callback:function(e){t.$set(t.formData,"number",e)},expression:"formData.number"}})],1),a("el-form-item",{attrs:{label:"支付方式"}},[a("el-select",{attrs:{placeholder:"选择支付方式"},model:{value:t.formData.paymentWay,callback:function(e){t.$set(t.formData,"paymentWay",e)},expression:"formData.paymentWay"}},[a("el-option",{attrs:{value:null,label:"所有"}}),a("el-option",{attrs:{label:"账户余额",value:"BALANCE"}}),a("el-option",{attrs:{label:"通帐转帐",value:"TRANSFER"}}),a("el-option",{attrs:{label:"微信支付",value:"WEIXIN_PAY"}}),a("el-option",{attrs:{label:"支付宝支付",value:"ALI_PAY"}}),a("el-option",{attrs:{label:"刷卡支付",value:"CREDIT_CARD"}}),a("el-option",{attrs:{label:"现金支付",value:"CASH"}})],1)],1),a("el-form-item",{attrs:{label:"订单状态"}},[a("el-select",{attrs:{placeholder:"选择订单状态"},model:{value:t.formData.orderState,callback:function(e){t.$set(t.formData,"orderState",e)},expression:"formData.orderState"}},[a("el-option",{attrs:{value:null,label:"所有"}}),a("el-option",{attrs:{label:"等待接单",value:"WAITING_RECEIVE"}}),a("el-option",{attrs:{label:"生产中",value:"PRODUCING"}}),a("el-option",{attrs:{label:"配送中",value:"DELIVERING"}}),a("el-option",{attrs:{label:"已完成",value:"FINISHED"}}),a("el-option",{attrs:{label:"退款",value:"REFUND"}}),a("el-option",{attrs:{label:"过期",value:"EXPIRED"}})],1)],1),a("el-form-item",{attrs:{label:"显示删除"}},[a("el-select",{attrs:{placeholder:"是否显示删除的订单"},model:{value:t.formData.showDelete,callback:function(e){t.$set(t.formData,"showDelete",e)},expression:"formData.showDelete"}},[a("el-option",{attrs:{value:0,label:"不显示"}}),a("el-option",{attrs:{value:1,label:"显示"}})],1)],1),a("el-form-item",{attrs:{label:"预约日期"}},[a("el-date-picker",{attrs:{"end-placeholder":"end date",format:"yyyy-MM-dd","start-placeholder":"start date",type:"daterange","value-format":"yyyy-MM-dd"},model:{value:t.formData.formDate,callback:function(e){t.$set(t.formData,"formDate",e)},expression:"formData.formDate"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSearch}},[t._v("查询")])],1)],1)],1),a("base-card",{staticClass:"container-main"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticClass:"tb-edit",staticStyle:{width:"100%"},attrs:{data:t.tableData,"element-loading-text":"正在加载中...","highlight-current-row":"",stripe:""},on:{"expand-change":t.getOrderDetail}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.detail.hasOwnProperty("address")?a("div",{staticClass:"order-expand"},[a("base-card",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.row.detail.orderItemList,"show-header":!1,stripe:""}},[a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.produceName)+" "),""!==e.row.goodsTitle?a("el-tag",{attrs:{effect:"dark",size:"mini"}},[t._v(t._s(e.row.goodsTitle)+" ")]):t._e()]}}],null,!0)}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[""!==e.row.goodsThumb?a("img",{staticStyle:{height:"30px",width:"auto"},attrs:{src:t.$VUE_APP_BASE_API+e.row.goodsThumb}}):t._e()]}}],null,!0)}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" ₩ "+t._s(e.row.goodsPrice.toLocaleString())+" ")]}}],null,!0)}),a("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" x "+t._s(e.row.goodsCount)+" ")]}}],null,!0)})],1)],1),a("base-card",[a("el-form",{staticClass:"order-expand-form",attrs:{"label-position":"left"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"订单 ID"}},[a("span",[t._v(t._s(e.row.id))])]),a("el-form-item",{attrs:{label:"用户 ID"}},[a("span",[t._v(t._s(e.row.userId))])]),a("el-form-item",{attrs:{label:"创建时间"}},[a("span",[t._v(t._s(e.row.createDate))])]),a("el-form-item",{attrs:{label:"总金额"}},[a("span",[t._v("₩ "+t._s(e.row.allPrice.toLocaleString()))])]),a("el-form-item",{attrs:{label:"优惠"}},[a("span",[t._v("₩ "+t._s(e.row.discountedPrices.toLocaleString()))]),""!=e.row.discount?a("span",[t._v("("+t._s(e.row.discount)+"折)")]):t._e()]),""!==e.row.detail.orderDetail.ps?a("el-form-item",{attrs:{label:"备注"}},[a("span",[t._v(t._s(e.row.detail.orderDetail.ps))])]):t._e()],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"地址"}},[a("div",[a("div",[t._v(t._s(e.row.detail.address.address))]),a("div",[t._v(t._s(e.row.detail.address.detail))])])]),a("el-form-item",{attrs:{label:"联系方式"}},[a("span",[t._v(t._s(e.row.detail.address.phone))])])],1)],1)],1)],1)],1):t._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:"预约号",prop:"number",width:"80"}}),a("el-table-column",{attrs:{align:"center",label:"用户"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(e.row.userName))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"商品数量",prop:"goodsCount",width:"80"}}),a("el-table-column",{attrs:{align:"center",label:"总金额",prop:"allPrice"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v("₩ "+t._s(e.row.allPrice.toLocaleString()))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"折扣/抵扣金额",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.discount>0?a("div",[t._v(t._s(e.row.discount)+"折")]):t._e(),e.row.discountedPrices>0?a("div",[t._v("₩ "+t._s(e.row.discountedPrices.toLocaleString()))]):t._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:"实际金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v("₩ "+t._s(e.row.realPrice.toLocaleString()))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"支付方式"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",[t._v(t._s(t._f("paymentWayFormat")(e.row.paymentWay)))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"支付状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["PAID"===e.row.payState?a("el-tag",{attrs:{type:"success"}},[t._v(" "+t._s(t._f("payStateFormat")(e.row.payState))+" ")]):t._e(),"PAY_LATER"===e.row.payState?a("el-tag",{attrs:{type:"warning"}},[t._v(" "+t._s(t._f("payStateFormat")(e.row.payState))+" ")]):t._e(),"UN_PAY"===e.row.payState?a("el-tag",{attrs:{type:"danger"}},[t._v(" "+t._s(t._f("payStateFormat")(e.row.payState))+" ")]):t._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:"订单状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["FINISHED"===e.row.orderState?a("el-tag",{attrs:{type:"success"}},[t._v(" "+t._s(t._f("orderStateFormat")(e.row.orderState))+" ")]):"REFUND"===e.row.orderState?a("el-tag",{attrs:{type:"danger"}},[t._v(" "+t._s(t._f("orderStateFormat")(e.row.orderState))+" ")]):"EXPIRED"===e.row.orderState?a("el-tag",{attrs:{type:"info"}},[t._v(" "+t._s(t._f("orderStateFormat")(e.row.orderState))+" ")]):a("el-tag",[t._v(" "+t._s(t._f("orderStateFormat")(e.row.orderState))+" ")]),1===e.row.deleted?a("el-tag",{attrs:{type:"info"}},[t._v(" 已删除 ")]):t._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:"预约时间",prop:"appointmentDate"}}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"action-btns"},["WAITING_RECEIVE"===e.row.orderState&&"PAID"!==e.row.payState?a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.onEditOrder(e.row.id)}}},[t._v("编辑 ")]):t._e(),"WEIXIN_PAY"!==e.row.paymentWay&&"TRANSFER"!==e.row.paymentWay&&"ALI_PAY"!==e.row.paymentWay||"UN_PAY"!==e.row.payState||"WAITING_RECEIVE"!==e.row.orderState?t._e():a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onConfirmPay(e.row)}}},[t._v(" 确认收款 ")]),"UN_PAY"===e.row.payState||"PRODUCING"!==e.row.orderState&&"DELIVERING"!==e.row.orderState?t._e():a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onPrintOrder(e.row)}}},[t._v(" 打印 ")]),"WAITING_RECEIVE"===e.row.orderState&&"UN_PAY"!==e.row.payState?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onReceiveOrder(e.row)}}},[t._v("接单 ")]):t._e(),"PRODUCING"===e.row.orderState?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onDeliveryOrder(e.row)}}},[t._v("配送 ")]):t._e(),"DELIVERING"===e.row.orderState?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.onFinishOrder(e.row)}}},[t._v("完成 ")]):t._e(),"EXPIRED"!==e.row.orderState&&"REFUND"!==e.row.orderState&&("PAID"===e.row.payState||"PAY_LATER"===e.row.payState&&"FINISHED"===e.row.orderState)?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.onRefundOrder(e.row)}}},[t._v(" 退款 ")]):t._e(),"EXPIRED"!==e.row.orderState&&"REFUND"!==e.row.orderState||0!==e.row.deleted?t._e():a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.onDeleteOrder(e.row)}}},[t._v(" 删除 ")])],1)]}}])})],1),a("el-pagination",{staticStyle:{"margin-top":"15px"},attrs:{"current-page":t.page.current,"page-size":t.page.size,"page-sizes":[15,50,100],total:t.page.total,background:"",layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange}})],1),a("edit-order-dialog",{ref:"edit-order-dialog"})],1)},o=[],n=(a("7db0"),a("4160"),a("d3b7"),a("159b"),a("96cf"),a("1da1")),l=a("a145"),i=a("da6b"),s=a("f8b7"),c=a("ed08"),d={name:"AppointmentOrder",filters:{orderStateFormat:function(t){return Object(c["e"])(t)},payStateFormat:function(t){return Object(c["f"])(t)},paymentWayFormat:function(t){return Object(c["g"])(t)}},components:{BaseCard:l["a"],EditOrderDialog:i["a"]},data:function(){return{page:{current:1,size:15,total:0},formData:{nickName:null,number:null,orderId:null,paymentWay:null,orderState:null,showDelete:0,orderType:"APPOINTMENT",formDate:[null,null]},listLoading:!1,tableData:[]}},created:function(){var t=new Date;t=t.setHours(t.getHours()+72),this.formData.formDate[0]=new Date,this.formData.formDate[1]=new Date(t),this.onSearch()},methods:{onSearch:function(){this.page.current=1,this.getList()},getList:function(){var t=this;this.listLoading=!0;var e=Object.assign({},this.formData);e.appointmentStartDate=Object(c["k"])(e.formDate[0],"{y}-{m}-{d}"),e.appointmentEndDate=Object(c["k"])(e.formDate[1],"{y}-{m}-{d}"),s["a"].getOrderListByPage(this.page,e).then((function(e){var a=e.records;a.forEach((function(t){t.detail={}})),t.tableData=a,t.page.total=parseInt(e.total)})).finally((function(){t.listLoading=!1}))},getOrderDetail:function(t,e){var a=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(o=e.find((function(e){return e.id===t.id})),void 0===o){r.next=4;break}return r.next=4,s["a"].getOrderDetail(t.id).then((function(t){a.$set(o,"detail",t)}));case 4:case"end":return r.stop()}}),r)})))()},handleSizeChange:function(t){this.page.size=t,this.getList()},handleCurrentChange:function(t){this.page.current=t,this.getList()},onEditOrder:function(t){this.$refs["edit-order-dialog"].openDialog(t)},onPrintOrder:function(t){var e=this,a=this.$loading({lock:!0,fullscreen:!0,text:"打印中..."});s["a"].printOrder(t).then((function(a){e.$message.success("打印成功"),t.payState="PAID"})).catch((function(t){e.$message.error(t)})).finally((function(){a.close()}))},onConfirmPay:function(t){var e=this;this.$confirm("确定此账户已付款?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].confirmPay(t.id).then((function(a){e.$message.success(a.message),t.payState="PAID"}))}))},onReceiveOrder:function(t){var e=this,a=this.$loading({lock:!0,fullscreen:!0,text:"正在处理,请稍等..."});s["a"].receiveOrder(t.id).then((function(a){e.$message.success(a.message),t.orderState="PRODUCING"})).finally((function(){a.close()}))},onDeliveryOrder:function(t){var e=this;s["a"].deliveryOrder(t.id).then((function(a){e.$message.success(a.message),t.orderState="DELIVERING"}))},onFinishOrder:function(t){var e=this;this.$confirm("确定当前订单已完成?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].finishOrder(t.id).then((function(a){e.$message.success(a.message),t.orderState="FINISHED"}))}))},onRefundOrder:function(t){var e=this;this.$confirm("确定要退款吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].refundOrder(t.id).then((function(a){e.$message.success(a.message),t.orderState="REFUND"}))}))},onDeleteOrder:function(t){var e=this;this.$confirm("确定要删除这个订单吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){s["a"].deleteOrder(t.id).then((function(t){e.$message.success(t.message),e.getList()}))}))}}},u=d,f=(a("271d"),a("adf3"),a("2877")),m=Object(f["a"])(u,r,o,!1,null,"5ca8a73d",null);e["default"]=m.exports},"271d":function(t,e,a){"use strict";var r=a("b6e1"),o=a.n(r);o.a},6127:function(t,e,a){},"7db0":function(t,e,a){"use strict";var r=a("23e7"),o=a("b727").find,n=a("44d2"),l=a("ae40"),i="find",s=!0,c=l(i);i in[]&&Array(1)[i]((function(){s=!1})),r({target:"Array",proto:!0,forced:s||!c},{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),n(i)},adf3:function(t,e,a){"use strict";var r=a("6127"),o=a.n(r);o.a},b6e1:function(t,e,a){},da6b:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:null===t.formData,expression:"formData===null"}],attrs:{"close-on-click-modal":!1,visible:t.dialogFormVisible,size:"mini",title:"编辑订单",width:"400px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[null!==t.formData?a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"订单ID","label-width":"80"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.formData.id,callback:function(e){t.$set(t.formData,"id",e)},expression:"formData.id"}})],1),a("el-form-item",{attrs:{label:"折扣","label-width":"80"}},[a("el-input",{attrs:{type:"number"},model:{value:t.formData.discount,callback:function(e){t.$set(t.formData,"discount",t._n(e))},expression:"formData.discount"}})],1),a("el-form-item",{attrs:{label:"备注","label-width":"80"}},[a("el-input",{attrs:{rows:3,type:"textarea"},model:{value:t.formData.ps,callback:function(e){t.$set(t.formData,"ps",e)},expression:"formData.ps"}})],1)],1):t._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.editOrder}},[t._v("编 辑")])],1)],1)},o=[],n=a("f8b7"),l={name:"EditOrderDialog",data:function(){return{dialogFormVisible:!1,formData:null}},methods:{init:function(t){var e=this;this.formData=null,n["a"].getOrderDetail(t).then((function(t){e.formData={id:t.id,discount:t.discount,ps:t.ps}}))},openDialog:function(t){this.init(t),this.dialogFormVisible=!0},editOrder:function(){var t=this;n["a"].editOrder(this.formData).then((function(e){t.$message.success(e.message)}))}}},i=l,s=a("2877"),c=Object(s["a"])(i,r,o,!1,null,"2708142c",null);e["a"]=c.exports}}]);